name: MSRV Check

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ main ]

jobs:
  verify-msrv:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Extract MSRV from Cargo.toml
        id: extract_msrv
        # This one-liner pulls the version string from Cargo.toml
        run: |
          MSRV=$(grep '^rust-version' Cargo.toml | cut -d '"' -f 2)
          echo "msrv=$MSRV" >> $GITHUB_OUTPUT
          echo "Detected MSRV: $MSRV"

      - name: Install Rust Toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          toolchain: ${{ steps.extract_msrv.outputs.msrv }}

      - name: Run MSRV Check
        # We use --all-targets to ensure tests/examples also respect the MSRV
        run: cargo check --all-targets --locked
